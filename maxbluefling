local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local hrp = character:WaitForChild("HumanoidRootPart")

local targetAnimationId = "rbxassetid://101162958113766"
local launchSpeed = 500
local tiltAmount = 0
local angleSpread = 20
local maxChecks = 10

local enabled = true

local function lookUp()
	local currentCFrame = hrp.CFrame
	hrp.CFrame = currentCFrame * CFrame.Angles(math.rad(-tiltAmount), 0, 0)
end

local function getRandomClearDirection()
	local forward = hrp.CFrame.LookVector
	for i = 1, maxChecks do
		local randomYaw = math.rad(math.random(-angleSpread, angleSpread))
		local randomPitch = math.rad(-math.random(20, 45)) 
		local direction = (CFrame.fromEulerAnglesYXZ(randomPitch, randomYaw, 0) * CFrame.new(forward)).Position
		direction = direction.Unit
		local rayParams = RaycastParams.new()
		rayParams.FilterDescendantsInstances = {character}
		rayParams.FilterType = Enum.RaycastFilterType.Blacklist
		local result = Workspace:Raycast(hrp.Position, direction * 10, rayParams)
		if not result then
			return direction
		end
	end
	return Vector3.new(0, 1, 0)
end

local function flyUpAtAngle()
	local dir = getRandomClearDirection()
	local bodyVel = Instance.new("BodyVelocity")
	bodyVel.Velocity = dir * launchSpeed
	bodyVel.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
	bodyVel.Parent = hrp
	task.delay(0.5, function()
		bodyVel:Destroy()
	end)
end

humanoid.AnimationPlayed:Connect(function(track)
	if enabled then
		local animId = track.Animation.AnimationId
		if animId == targetAnimationId then
			lookUp()
			task.delay(0.6, function()
				flyUpAtAngle()
			end)
		end
	end
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if not gameProcessed and input.KeyCode == Enum.KeyCode.Nine then
		enabled = not enabled
	end
end)
