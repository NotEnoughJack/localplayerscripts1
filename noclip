local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local hrp = character:WaitForChild("HumanoidRootPart")

local noclipEnabled = true -- Change to false if you want to disable initially

local raycastParams = RaycastParams.new()
raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
raycastParams.FilterDescendantsInstances = {character}
raycastParams.IgnoreWater = true

RunService.RenderStepped:Connect(function()
	if not noclipEnabled then return end

	-- Raycast downward from HRP to find the floor part
	local origin = hrp.Position
	local direction = Vector3.new(0, -10, 0) -- Cast 10 studs down

	local result = Workspace:Raycast(origin, direction, raycastParams)
	local floorPart = result and result.Instance

	for _, part in ipairs(Workspace:GetDescendants()) do
		if part:IsA("BasePart") and not part:IsDescendantOf(character) then
			if part == floorPart then
				part.CanCollide = true
			else
				part.CanCollide = false
			end
		end
	end
end)
