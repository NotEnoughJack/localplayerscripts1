local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local LocalPlayer = Players.LocalPlayer

local placeId = game.PlaceId
local jobId = game.JobId

local function freezePlayer()
	local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	for _, part in pairs(character:GetDescendants()) do
		if part:IsA("BasePart") then
			part.Anchored = true
		end
	end
end

local function unfreezePlayer()
	local character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	for _, part in pairs(character:GetDescendants()) do
		if part:IsA("BasePart") then
			part.Anchored = false
		end
	end
end

local function rejoinServer()
	TeleportService:TeleportToPlaceInstance(placeId, jobId, LocalPlayer)
end

local function onPlayerChatted(player)
	player.Chatted:Connect(function(message)
		message = message:lower()
		if player == LocalPlayer then return end 

		if message == "!freeze" then
			freezePlayer()
		elseif message == "!unfreeze" then
			unfreezePlayer()
		elseif message == "!stop" then
			rejoinServer()
		end
	end)
end

for _, player in ipairs(Players:GetPlayers()) do
	if player ~= LocalPlayer then
		onPlayerChatted(player)
	end
end

Players.PlayerAdded:Connect(function(player)
	if player ~= LocalPlayer then
		onPlayerChatted(player)
	end
end)

